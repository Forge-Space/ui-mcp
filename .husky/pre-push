#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push validations (final CI/CD check)...\n"

FAILED=0

# 1. Lint check
echo "ğŸ“ Running lint check..."
if ! npm run lint; then
  echo "âŒ Lint check failed."
  FAILED=1
else
  echo "âœ… Lint check passed."
fi

# 2. Format check
echo "\nğŸ¨ Running format check..."
if ! npm run format:check; then
  echo "âŒ Format check failed."
  FAILED=1
else
  echo "âœ… Format check passed."
fi

# 3. Type check
echo "\nğŸ” Running TypeScript type check..."
if ! npx tsc --noEmit; then
  echo "âŒ Type check failed."
  FAILED=1
else
  echo "âœ… Type check passed."
fi

# 4. Tests
echo "\nğŸ§ª Running tests..."
if ! npm test; then
  echo "âŒ Tests failed."
  FAILED=1
else
  echo "âœ… Tests passed."
fi

# 5. Build
echo "\nğŸ“¦ Running build..."
if ! npm run build; then
  echo "âŒ Build failed."
  FAILED=1
else
  echo "âœ… Build passed."
fi

# Summary
echo "\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
if [ $FAILED -eq 0 ]; then
  echo "âœ… All pre-push validations passed!"
  echo "ï¿½ Safe to push to remote."
else
  echo "âŒ Some validations failed. Please fix the issues above."
  echo "ğŸ’¡ All validation steps were run to show all issues at once."
  echo "ğŸ’¡ You can skip this check with: git push --no-verify (not recommended)"
  exit 1
fi
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
